C51 COMPILER V9.54   MAIN                                                                  11/27/2022 17:43:10 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: E:\dev\keil5for51\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listin
                    -gs\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          /**************************************************************************************
   2          æ·±åœ³å¸‚æ™®ä¸­ç§‘æŠ€æœ‰é™å…¬å¸ï¼ˆPRECHIN æ™®ä¸­ï¼‰
   3          æŠ€æœ¯æ”¯æŒï¼šwww.prechin.net
   4          
   5          å®éªŒåç§°ï¼šçŸ©é˜µæŒ‰é”®å®éªŒ
   6          æ¥çº¿è¯´æ˜ï¼š 
   7          å®éªŒç°è±¡ï¼šä¸‹è½½ç¨‹åºåï¼ŒæŒ‰ä¸‹â€œçŸ©é˜µæŒ‰é”®â€æ¨¡å—ä¸­S1-S16é”®ï¼Œå¯¹åº”æ•°ç ç®¡æœ€å·¦è¾¹æ˜¾ç
             -¤º0-F
   8          æ³¨æ„äº‹é¡¹ï¼š                                         
   9          ***************************************************************************************/
  10          #include "reg52.h"
  11          
  12          typedef unsigned int u16; //å¯¹ç³»ç»Ÿé»˜è®¤æ•°æ®ç±»å‹è¿›è¡Œé‡å®šä¹‰
  13          typedef unsigned char u8;
  14          
  15          #define KEY_MATRIX_PORT P1  //ä½¿ç”¨å®å®šä¹‰çŸ©é˜µæŒ‰é”®æ§åˆ¶å£    
  16          
  17          #define SMG_A_DP_PORT P0  //ä½¿ç”¨å®å®šä¹‰æ•°ç ç®¡æ®µç å£
  18          
  19          //å…±é˜´ææ•°ç ç®¡æ˜¾ç¤º0~Fçš„æ®µç æ•°æ®
  20          u8 gsmg_code[17]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,
  21                  0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71}; 
  22          
  23          /*******************************************************************************
  24          * å‡½ æ•° å       : delay_10us
  25          * å‡½æ•°åŠŸèƒ½     : å»¶æ—¶å‡½æ•°ï¼Œten_us=1æ—¶ï¼Œå¤§çº¦å»¶æ—¶10us
  26          * è¾“    å…¥       : ten_us
  27          * è¾“    å‡º       : æ— 
  28          *******************************************************************************/
  29          void delay_10us(u16 ten_us)
  30          {
  31   1        while(ten_us--);  
  32   1      }
  33          
  34          /*******************************************************************************
  35          * å‡½ æ•° å       : key_matrix_ranks_scan
  36          * å‡½æ•°åŠŸèƒ½     : ä½¿ç”¨è¡Œåˆ—å¼æ‰«ææ–¹æ³•ï¼Œæ£€æµ‹çŸ©é˜µæŒ‰é”®æ˜¯å¦æŒ‰ä¸‹ï¼ŒæŒ‰ä¸‹åˆ™è¿”å›å¯¹åº”é”®
             -å€¼
  37          * è¾“    å…¥       : æ— 
  38          * è¾“    å‡º       : key_valueï¼š1-16ï¼Œå¯¹åº”S1-S16é”®ï¼Œ
  39                     0ï¼šæŒ‰é”®æœªæŒ‰ä¸‹
  40          *******************************************************************************/
  41          u8 key_matrix_ranks_scan(void)
  42          {
  43   1        u8 key_value=0;
  44   1      
  45   1        KEY_MATRIX_PORT=0xf7;//ç»™ç¬¬ä¸€åˆ—èµ‹å€¼0ï¼Œå…¶ä½™å…¨ä¸º1
  46   1        if(KEY_MATRIX_PORT!=0xf7)//åˆ¤æ–­ç¬¬ä¸€åˆ—æŒ‰é”®æ˜¯å¦æŒ‰ä¸‹
  47   1        {
  48   2          delay_10us(1000);//æ¶ˆæŠ–
  49   2          switch(KEY_MATRIX_PORT)//ä¿å­˜ç¬¬ä¸€åˆ—æŒ‰é”®æŒ‰ä¸‹åçš„é”®å€¼  
  50   2          {
  51   3            case 0x77: key_value=1;break;
  52   3            case 0xb7: key_value=5;break;
C51 COMPILER V9.54   MAIN                                                                  11/27/2022 17:43:10 PAGE 2   

  53   3            case 0xd7: key_value=9;break;
  54   3            case 0xe7: key_value=13;break;
  55   3          }
  56   2        }
  57   1        while(KEY_MATRIX_PORT!=0xf7);//ç­‰å¾…æŒ‰é”®æ¾å¼€ 
  58   1        
  59   1        KEY_MATRIX_PORT=0xfb;//ç»™ç¬¬äºŒåˆ—èµ‹å€¼0ï¼Œå…¶ä½™å…¨ä¸º1
  60   1        if(KEY_MATRIX_PORT!=0xfb)//åˆ¤æ–­ç¬¬äºŒåˆ—æŒ‰é”®æ˜¯å¦æŒ‰ä¸‹
  61   1        {
  62   2          delay_10us(1000);//æ¶ˆæŠ–
  63   2          switch(KEY_MATRIX_PORT)//ä¿å­˜ç¬¬äºŒåˆ—æŒ‰é”®æŒ‰ä¸‹åçš„é”®å€¼  
  64   2          {
  65   3            case 0x7b: key_value=2;break;
  66   3            case 0xbb: key_value=6;break;
  67   3            case 0xdb: key_value=10;break;
  68   3            case 0xeb: key_value=14;break;
  69   3          }
  70   2        }
  71   1        while(KEY_MATRIX_PORT!=0xfb);//ç­‰å¾…æŒ‰é”®æ¾å¼€ 
  72   1        
  73   1        KEY_MATRIX_PORT=0xfd;//ç»™ç¬¬ä¸‰åˆ—èµ‹å€¼0ï¼Œå…¶ä½™å…¨ä¸º1
  74   1        if(KEY_MATRIX_PORT!=0xfd)//åˆ¤æ–­ç¬¬ä¸‰åˆ—æŒ‰é”®æ˜¯å¦æŒ‰ä¸‹
  75   1        {
  76   2          delay_10us(1000);//æ¶ˆæŠ–
  77   2          switch(KEY_MATRIX_PORT)//ä¿å­˜ç¬¬ä¸‰åˆ—æŒ‰é”®æŒ‰ä¸‹åçš„é”®å€¼  
  78   2          {
  79   3            case 0x7d: key_value=3;break;
  80   3            case 0xbd: key_value=7;break;
  81   3            case 0xdd: key_value=11;break;
  82   3            case 0xed: key_value=15;break;
  83   3          }
  84   2        }
  85   1        while(KEY_MATRIX_PORT!=0xfd);//ç­‰å¾…æŒ‰é”®æ¾å¼€ 
  86   1        
  87   1        KEY_MATRIX_PORT=0xfe;//ç»™ç¬¬å››åˆ—èµ‹å€¼0ï¼Œå…¶ä½™å…¨ä¸º1
  88   1        if(KEY_MATRIX_PORT!=0xfe)//åˆ¤æ–­ç¬¬å››åˆ—æŒ‰é”®æ˜¯å¦æŒ‰ä¸‹
  89   1        {
  90   2          delay_10us(1000);//æ¶ˆæŠ–
  91   2          switch(KEY_MATRIX_PORT)//ä¿å­˜ç¬¬å››åˆ—æŒ‰é”®æŒ‰ä¸‹åçš„é”®å€¼  
  92   2          {
  93   3            case 0x7e: key_value=4;break;
  94   3            case 0xbe: key_value=8;break;
  95   3            case 0xde: key_value=12;break;
  96   3            case 0xee: key_value=16;break;
  97   3          }
  98   2        }
  99   1        while(KEY_MATRIX_PORT!=0xfe);//ç­‰å¾…æŒ‰é”®æ¾å¼€
 100   1        
 101   1        return key_value;   
 102   1      }
 103          
 104          /*******************************************************************************
 105          * å‡½ æ•° å       : key_matrix_flip_scan
 106          * å‡½æ•°åŠŸèƒ½     : ä½¿ç”¨çº¿ç¿»è½¬æ‰«ææ–¹æ³•ï¼Œæ£€æµ‹çŸ©é˜µæŒ‰é”®æ˜¯å¦æŒ‰ä¸‹ï¼ŒæŒ‰ä¸‹åˆ™è¿”å›å¯¹åº”é”®
             -å€¼
 107          * è¾“    å…¥       : æ— 
 108          * è¾“    å‡º       : key_valueï¼š1-16ï¼Œå¯¹åº”S1-S16é”®ï¼Œ
 109                     0ï¼šæŒ‰é”®æœªæŒ‰ä¸‹
 110          *******************************************************************************/
 111          u8 key_matrix_flip_scan(void)
 112          {
 113   1        static u8 key_value=0;
C51 COMPILER V9.54   MAIN                                                                  11/27/2022 17:43:10 PAGE 3   

 114   1      
 115   1        KEY_MATRIX_PORT=0x0f;//ç»™æ‰€æœ‰è¡Œèµ‹å€¼0ï¼Œåˆ—å…¨ä¸º1
 116   1        if(KEY_MATRIX_PORT!=0x0f)//åˆ¤æ–­æŒ‰é”®æ˜¯å¦æŒ‰ä¸‹
 117   1        {
 118   2          delay_10us(1000);//æ¶ˆæŠ–
 119   2          if(KEY_MATRIX_PORT!=0x0f)
 120   2          {
 121   3            //æµ‹è¯•åˆ—
 122   3            KEY_MATRIX_PORT=0x0f;
 123   3            switch(KEY_MATRIX_PORT)//ä¿å­˜è¡Œä¸º0ï¼ŒæŒ‰é”®æŒ‰ä¸‹åçš„åˆ—å€¼ 
 124   3            {
 125   4              case 0x07: key_value=1;break;
 126   4              case 0x0b: key_value=2;break;
 127   4              case 0x0d: key_value=3;break;
 128   4              case 0x0e: key_value=4;break;
 129   4            }
 130   3            //æµ‹è¯•è¡Œ
 131   3            KEY_MATRIX_PORT=0xf0;
 132   3            switch(KEY_MATRIX_PORT)//ä¿å­˜åˆ—ä¸º0ï¼ŒæŒ‰é”®æŒ‰ä¸‹åçš„é”®å€¼ 
 133   3            {
 134   4              case 0x70: key_value=key_value;break;
 135   4              case 0xb0: key_value=key_value+4;break;
 136   4              case 0xd0: key_value=key_value+8;break;
 137   4              case 0xe0: key_value=key_value+12;break;
 138   4            }
 139   3            while(KEY_MATRIX_PORT!=0xf0);//ç­‰å¾…æŒ‰é”®æ¾å¼€ 
 140   3          }
 141   2        }
 142   1        else
 143   1          key_value=0;    
 144   1        
 145   1        return key_value;   
 146   1      }
 147          
 148          /*******************************************************************************
 149          * å‡½ æ•° å       : main
 150          * å‡½æ•°åŠŸèƒ½     : ä¸»å‡½æ•°
 151          * è¾“    å…¥       : æ— 
 152          * è¾“    å‡º       : æ— 
 153          *******************************************************************************/
 154          void main()
 155          { 
 156   1        u8 key=0;
 157   1      
 158   1        while(1)
 159   1        {
 160   2            key=key_matrix_ranks_scan();
 161   2          if(key!=0)
 162   2            SMG_A_DP_PORT=gsmg_code[key-1];//å¾—åˆ°çš„æŒ‰é”®å€¼å‡1æ¢ç®—æˆæ•°ç»„ä¸‹æ ‡å¯¹åº”0-Fæ®µç    
 163   2        }   
 164   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    365    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     18       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.

C51 COMPILER V9.54   MAIN                                                                  11/27/2022 17:43:10 PAGE 4   


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
